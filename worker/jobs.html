<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worker Jobs - 12failjob.com</title>
  <link rel="stylesheet" href="../styles-new.css" />
  <style>
    /* Worker-friendly big UI */
    .big-input{width:100%;padding:14px;font-size:18px;border-radius:12px}
    .big-btn{padding:14px 16px;font-size:18px;border-radius:12px}
    .jobs-grid{display:grid;grid-template-columns:1fr;gap:12px}
    .job-card{padding:16px}
    .job-title{font-size:22px;font-weight:900;margin:0 0 6px}
    .job-meta{font-size:16px;margin:4px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1}
  </style>
</head>
<body>
  <div data-include="header"></div>

  <main class="page-main">
    <div class="row">
      <a href="home.html" class="btn big-btn">← <span >Back</span></a>
      <a href="../index.html" class="btn btn-primary big-btn" >Change Language</a>
    </div>

    <h1 class="section-title" style="margin-top:14px;" id="pageTitle">Jobs</h1>
    <p class="meta" id="pageSub" >Search simple. Tap job to view details.</p>

    <div class="card" style="padding:14px;margin-top:12px;">
      <div class="form-group">
        <label for="q" >Search</label>
        <input class="big-input" id="q" type="text" data-i18n-placeholder="search_ph" placeholder="Search job (helper, maid...)">
      </div>

      <div class="form-group">
        <label for="location" >Location</label>
        <input class="big-input" id="location" type="text" data-i18n-placeholder="location_ph" placeholder="City (Chennai...)">
      </div>

      <div class="form-group">
        <label for="education" >Education</label>
        <select class="big-input" id="education">
          <option value="" >Any</option>
          <option value="18+">18+ student</option>
          <option value="12th">12th fail</option>
          <option value="18+/12th">18+ or 12th fail</option>
        </select>
      </div>

      <div class="row">
        <button class="btn btn-primary big-btn" id="searchBtn" type="button" >Search</button>
        <button class="btn big-btn" id="clearBtn" type="button" >Clear</button>
      </div>
    </div>

    <div id="jobsList" class="jobs-grid" style="margin-top:14px;"></div>
  </main>

  <script src="../js/app.js"></script>
  <script src="../js/partials-unified.js"></script>
  <script>
    function esc(s){
      return String(s||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }

    function getParam(name){
      return new URLSearchParams(location.search).get(name) || "";
    }

    function setTitleByCategory(cat){
      const title = document.getElementById("pageTitle");
      const sub = document.getElementById("pageSub");
      if (cat) {
        title.textContent = cat + " Jobs";
        sub.textContent = "Showing " + cat + " jobs posted by recruiters";
      } else {
        title.textContent = "All Jobs";
        sub.textContent = "Search simple. Tap job to view details.";
      }
    }

    function jobCard(job){
      return `
        <div class="card job-card">
          <div class="job-title">${esc(job.title)}</div>
          <div class="job-meta"><strong>${esc(job.company)}</strong> • ${esc(job.location)}</div>
          <div class="job-meta">${esc(job.education || "")} ${job.job_type ? "• " + esc(job.job_type) : ""}</div>
          ${job.salary ? `<div class="job-meta"><strong>Salary:</strong> ${esc(job.salary)}</div>` : ""}
          ${job.category ? `<div class="job-meta"><strong>Category:</strong> ${esc(job.category)}</div>` : ""}
          <div style="margin-top:10px;">
            <a class="btn btn-primary big-btn" href="job-details.html?id=${job.id}">View</a>
          </div>
        </div>
      `;
    }

    async function loadJobs(){
      const list = document.getElementById("jobsList");
      list.innerHTML = `<p class="meta">Loading...</p>`;

      const q = document.getElementById("q").value.trim();
      const location = document.getElementById("location").value.trim();
      const education = document.getElementById("education").value;
      const category = getParam("category");

      const params = new URLSearchParams();
      if (q) params.set("q", q);
      if (location) params.set("location", location);
      if (education) params.set("education", education);
      if (category) params.set("category", category);

      try{
        const res = await fetch(API("jobs_list") + (params.toString() ? `?${params.toString()}` : ""));
        const data = await res.json();

        if (!data.ok){
          list.innerHTML = `<p class="meta">Failed to load jobs.</p>`;
          return;
        }

        const jobs = data.jobs || [];
        if (jobs.length === 0){
          list.innerHTML = `<p class="meta">No jobs found.</p>`;
          return;
        }

        list.innerHTML = jobs.map(jobCard).join("");
      }catch(e){
        console.error(e);
        list.innerHTML = `<p class="meta">Server error. Check XAMPP.</p>`;
      }
    }

    document.getElementById("searchBtn").addEventListener("click", loadJobs);
    document.getElementById("clearBtn").addEventListener("click", () => {
      document.getElementById("q").value = "";
      document.getElementById("location").value = "";
      document.getElementById("education").value = "";
      loadJobs();
    });

    (async function(){
      // i18n
      await loadLang();
      applyI18n();

      const category = getParam("category");
      setTitleByCategory(category);

      loadJobs();
    })();
  </script>
</body>
</html>
